---
title: Linux
tag:
- Linux
---

# 什么是linux

linux是一个开源的操作系统。目前主流的发行版有，Debian(ubuntu)、Fedroa(redhat、centos)、SUSE(openSUSE)、其他版本

# linux系统启动流程

Linux 系统的启动流程是一个多阶段的过程，从按下电源按钮开始，到最终用户可以登录并使用系统。以下是详细的 Linux 系统启动流程：

## BIOS/UEFI 阶段

- **BIOS (Basic Input/Output System) 或 UEFI (Unified Extensible Firmware Interface)**：在开机时，系统的 BIOS 或 UEFI 固件会执行一系列硬件初始化操作。这包括自检 (POST，Power-On Self Test)，检测和初始化硬件设备（如 CPU、内存、硬盘等），并查找启动设备。
- **启动设备选择**：BIOS/UEFI 查找并加载启动设备中的引导加载程序（Bootloader）。启动顺序通常可以在 BIOS/UEFI 设置中配置。

## 引导加载程序阶段

- **引导加载程序（Bootloader）**：常见的引导加载程序有 GRUB（GRand Unified Bootloader）。引导加载程序的主要任务是将操作系统内核从启动设备（如硬盘）加载到内存中并执行。
  - **GRUB 阶段 1**：位于磁盘的主引导记录（MBR）或 GPT 的 EFI 系统分区中。其作用是找到并加载 GRUB 阶段 2。
  - **GRUB 阶段 2**：显示一个引导菜单，允许用户选择要启动的操作系统或内核选项。根据用户的选择，GRUB 将加载相应的内核映像和初始内存盘（initramfs/initrd）。

## 内核阶段

- **加载内核**：引导加载程序将 Linux 内核（通常是 vmlinuz）加载到内存中，并将控制权移交给内核。
- **初始内存盘（initramfs/initrd）**：内核加载初始内存盘，它包含内核启动过程中所需的临时文件系统和驱动程序。
- **内核初始化**：内核开始执行自身的初始化过程，包括：
  - 设置硬件（如 CPU、内存、设备驱动程序）。
  - 挂载根文件系统。
  - 启动第一个用户空间进程 `init`。

## init 阶段

- **`init` 进程**：传统的第一个用户空间进程是 `init`（PID 1），现代系统上通常由 `systemd` 替代。`init` 或 `systemd` 负责启动和管理系统的各个服务和进程。
  - **SysV init**：基于 `/etc/inittab` 配置文件，按照运行级别（runlevels）启动系统服务和守护进程。
  - **systemd**：基于单元文件（unit files），按依赖关系启动服务。配置文件位于 `/etc/systemd/system/` 和 `/lib/systemd/system/`。

## 启动用户空间服务

- **启动用户空间服务和守护进程**：`init` 或 `systemd` 按照配置文件启动所有必要的系统服务和守护进程。例如，网络服务、数据库服务、Web 服务等。

## 启动终端或图形用户界面（GUI）

- **多用户模式**：启动多个虚拟控制台（tty），用户可以通过这些控制台登录系统。
- **图形用户界面（GUI）**：如果系统配置为启动图形界面，`init` 或 `systemd` 会启动显示管理器（如 `gdm`, `lightdm`, `sddm`），从而提供图形登录界面。

## 用户登录

- **登录提示**：用户看到登录提示（TTY 终端）或图形登录界面（GUI），输入用户名和密码登录系统。
- **用户会话启动**：登录成功后，启动用户会话，包括用户的 shell 或桌面环境。

## 总结

1. **BIOS/UEFI 初始化**：硬件自检和启动设备选择。
2. **引导加载程序**：加载和执行操作系统内核。
3. **内核初始化**：硬件初始化和挂载根文件系统。
4. **`init` 进程**：启动系统服务和守护进程。
5. **启动用户空间服务**：启动多用户模式或图形用户界面。
6. **用户登录**：用户输入凭据登录系统，启动用户会话。

# 文件系统

在 Linux 系统中，文件系统采用分层的目录结构，每个目录都有特定的用途。以下是 Linux 文件系统的主要路径及其用途的介绍：

1.`/`

根目录是所有文件和目录的起点。所有其他目录都是根目录的子目录。

2.`/bin`

存放系统中最基本的用户命令，例如 `ls`, `cp`, `mv`, `rm`, `cat`, `bash` 等。这些命令在单用户模式下也需要使用，因此存放在这里。

3. `/sbin`

存放系统管理程序，只有超级用户（root）才能使用的命令，例如 `ifconfig`, `reboot`, `shutdown` 等。

4.`/boot`

存放引导加载器（如 GRUB）和内核文件，包括内核映像和初始内存盘（initrd 或 initramfs）。

5. `/dev`

存放设备文件，每个文件代表一个硬件设备，例如硬盘（`/dev/sda`），终端（`/dev/tty`），以及随机数生成器（`/dev/random`）。

6. `/etc`

存放系统的全局配置文件和启动脚本。例如网络配置文件、用户账户信息文件、服务启动脚本等。常见的文件包括 `/etc/passwd`, `/etc/fstab`, `/etc/hosts` 等。

7. `/home`

存放所有普通用户的主目录。每个用户都有一个子目录（如 `/home/username`），用于存放个人文件和配置。

8. `/lib`

存放基本系统命令和程序所需的共享库文件和内核模块。包括 C 库（glibc）等。

9. `/media`

挂载点目录，用于临时挂载可移动媒体设备（如 USB 闪存驱动器、CD/DVD）。

10. `/mnt`

挂载点目录，常用于临时挂载文件系统。管理员可以在此目录下创建子目录用于挂载额外的存储设备。

11. `/opt`

存放可选的应用软件包。一般是第三方应用程序和插件安装在这里。

12. `/proc`

虚拟文件系统，提供内核和进程信息。所有内容都在内存中生成，用于访问系统和进程的信息，例如 `/proc/cpuinfo`（CPU 信息）和 `/proc/meminfo`（内存信息）。

13. `/root`

超级用户（root）的主目录。与普通用户的主目录不同，`/root` 是唯一的，并且不在 `/home` 目录下。

14. `/run`

存放自系统启动以来的临时文件，例如进程 ID 文件（PID 文件）和套接字。这个目录是动态的，不需要重启后保存数据。

15. `/srv`

存放一些特定服务的数据。`srv` 意为 “server”，通常用于存放网站数据或 FTP 服务器的数据。

16. `/sys`

与 `/proc` 类似，是一个虚拟文件系统，用于显示和修改设备和内核的参数。提供系统硬件信息以及与硬件的交互界面。

17. `/tmp`

存放临时文件。系统和应用程序在运行时可以在此目录下创建临时文件。通常这个目录会在系统重启时清空。

18. `/usr`

包含用户级别的应用程序和文件。此目录通常包含二级目录，例如：

- `/usr/bin`: 大多数用户命令，类似于 `/bin`，但包含更多应用程序。
- `/usr/sbin`: 系统管理员的命令，类似于 `/sbin`。
- `/usr/lib`: 库文件，类似于 `/lib`。
- `/usr/local`: 手动安装的软件和自定义程序。子目录结构与 `/usr` 类似。
- `/usr/share`: 存放共享的、架构无关的数据文件，如文档、帮助文件和配置文件模板。

19. `/var`

存放可变数据文件，例如日志文件（`/var/log`）、临时电子邮件文件（`/var/mail`）、临时文件（`/var/tmp`）和缓存文件（`/var/cache`）。

# 定时任务

在 Linux 系统中，定时任务通常是通过 `cron` 来设置的。`cron` 是一个基于时间的任务调度程序，使用 `crontab` 文件来定义任务调度规则。下面是如何设置定时任务以及每个符号的意义。

## 设置定时任务步骤

1. **编辑用户的 `crontab` 文件**： 使用命令 `crontab -e` 进入编辑模式，开始编辑当前用户的 `crontab` 文件。
2. **添加任务调度规则**： 在 `crontab` 文件中，每一行代表一个任务，每行包含六个字段：前五个字段定义时间，第六个字段是要执行的命令。

## 字段符号及其意义

`crontab` 文件中的每行任务调度规则格式如下：

```scss
* * * * * command
- - - - -
| | | | |
| | | | +----- 星期几 (0 - 7) (星期日为 0 或 7)
| | | +------- 月份 (1 - 12)
| | +--------- 每月的哪一天 (1 - 31)
| +----------- 小时 (0 - 23)
+------------- 分钟 (0 - 59)
```

### 各个字段的详细解释

1. **分钟 (0 - 59)**：
   - 表示任务在每小时的哪一分钟执行。
2. **小时 (0 - 23)**：
   - 表示任务在一天中的哪个小时执行。
3. **每月的哪一天 (1 - 31)**：
   - 表示任务在每月的哪一天执行。
4. **月份 (1 - 12)**：
   - 表示任务在一年中的哪个月份执行。
5. **星期几 (0 - 7)**：
   - 表示任务在每周的哪一天执行，0 和 7 都表示星期日。

### 特殊符号

- `*`：星号表示任意时间。例如，如果分钟字段是 `*`，表示每分钟都会执行。
- `,`：逗号分隔符可以用来指定多个值。例如，`1,15` 在分钟字段表示第 1 分钟和第 15 分钟。
- `-`：连字符表示一个范围。例如，`1-5` 在小时字段表示从 1 点到 5 点。
- `/`：斜杠表示步进值。例如，`*/5` 在分钟字段表示每 5 分钟执行一次。

## 示例

1. **每天下午 3:30 执行命令**：

   ```shell
   30 15 * * * /path/to/command
   ```

2. **每周一到周五早上 8:00 执行命令**：

   ```shell
   0 8 * * 1-5 /path/to/command
   ```

3. **每 10 分钟执行一次命令**：

   ```shell
   */10 * * * * /path/to/command
   ```

4. **每个月的 1 号和 15 号早上 6:00 执行命令**：

   ```shell
   0 6 1,15 * * /path/to/command
   ```

5. **每周日凌晨 2:00 执行命令**：

   ```shell
   0 2 * * 0 /path/to/command
   ```

## 检查和管理定时任务

- **查看当前用户的定时任务**：使用命令 `crontab -l`。
- **删除当前用户的所有定时任务**：使用命令 `crontab -r`。

# 清理内存

## 清理内存

### 释放缓存、目录项和 inode

Linux 内核会使用内存缓存文件系统数据、目录项和 inode，这些缓存可以通过以下命令来释放：

```shell
# 同步文件系统缓冲区
sync

# 释放页面缓存
echo 1 > /proc/sys/vm/drop_caches

# 释放目录项和 inode
echo 2 > /proc/sys/vm/drop_caches

# 释放页面缓存、目录项和 inode
echo 3 > /proc/sys/vm/drop_caches
```

可以将这些命令组合到一个脚本中执行，例如 `clear_memory.sh`：

```shell
#!/bin/bash
sync
echo 3 > /proc/sys/vm/drop_caches
```

给脚本添加执行权限并执行：

```shell
chmod +x clear_memory.sh
./clear_memory.sh
```

### 使用 `htop` 或 `top` 监控和终止高内存使用进程

可以使用 `htop` 或 `top` 来查看系统中哪些进程占用了大量内存，然后手动终止不必要的进程。

```shell
htop
```

在 `htop` 中，按 `F6` 排序，选择 `MEM%` 来查看内存使用情况。

### 使用 `swapoff` 和 `swapon` 重置交换空间

如果系统使用了交换空间，可以通过以下命令重置交换空间：

```shell
swapoff -a
swapon -a
```

这将释放所有交换空间并重新启用它。

## 释放磁盘空间

### 删除不必要的文件和目录

```shell
rm -rf /path/to/unnecessary/file_or_directory
```

### 清理包缓存

对于基于 Debian 的系统（如 Ubuntu），可以清理 `apt` 缓存：

```
sudo apt-get clean
sudo apt-get autoremove
```

对于基于 Red Hat 的系统（如 CentOS），可以清理 `yum` 缓存：

```
sudo yum clean all
sudo yum autoremove
```

### 使用 `du` 和 `df` 检查磁盘使用情况

可以使用 `du` 和 `df` 命令来检查磁盘使用情况并确定哪些文件或目录占用了大量空间：

```shell
# 显示磁盘使用情况
df -h
# 显示当前目录及其子目录的磁盘使用情况
du -h --max-depth=1 /path/to/check
```

### 查找并删除大文件

可以使用 `find` 命令查找大文件并决定是否删除：

```shell
# 查找大于 100MB 的文件
find / -type f -size +100M
```

### 清理日志文件

日志文件可能会占用大量磁盘空间，可以清理旧的日志文件或压缩日志文件：

```shell
# 清空日志文件
echo "" > /var/log/syslog
echo "" > /var/log/auth.log

# 使用 logrotate 管理日志文件的轮转和压缩
sudo logrotate /etc/logrotate.conf
```

### 卸载不必要的包和依赖

可以使用包管理器卸载不再需要的软件包和依赖：

```shell
# 基于 Debian 系统
sudo apt-get remove --purge package_name
sudo apt-get autoremove

# 基于 Red Hat 系统
sudo yum remove package_name
sudo yum autoremove
```
