---
title: Kettel
tag: 
- ETL
---

# 数据分析工具对比

1. **SPSS**:
   - **优势**：适用于统计学分析运算、数据挖掘、预测分析和决策支持。
   - **用途**：在学术界和商业领域广泛使用。
2. **linggo**:
   - **优势**：主要用于教学，解决线性和非线性方程。
   - **用途**：在教育和研究中应用广泛。
3. **gephi**:
   - **优势**：解决网络社交关系分析的图。
   - **用途**：用于研究社交网络、网络分析和复杂系统的可视化。
4. **帆软**:
   - **FineReport**：类似于Excel，主要用于商业报表。
   - **FineBI**：用于大屏可视化进行数据分析，支持大数据BI。
   - **用途**：用于生成报表、数据分析和大数据可视化。
5. **Tableau**:
   - **优势**：拖放操作转化为数据查询，对数据进行可视化。
   - **用途**：用于数据可视化、交互式分析和实时数据监控。
6. **Power BI**:
   - **优势**：微软旗下的可视化报表，可以进行数据整合（Excel、数据库）、数据分析和实时数据监控。
   - **用途**：用于数据分析、报表制作和实时数据监控，与微软生态系统集成紧密。

# 简介

>Kettle，由Pentaho公司开发和维护,是一款开源的ETL(Extract、Transform、Load)工具，所以也称为Pentaho Data Integration(PDI)。
>
>Kettle主要用于数据的抽取、转换和加载，为用户提供了一系列丰富的数据整合功能，主要目标是将原始数据转化为有价值、有意义的信息。

# Kettle的安装与配置

## JAVA环境配置

>Kettle是基于JAVA开发的，如果运行需要配置JAVA_HOME环境变量（或者配置PENTAHO_JAVA_HOME），建议安装版本JDK1.8版本及以上

```shell
# 系统变量
变量名：`JAVA_HOME` 变量值：`D:\jdk1.8.0_291`
# PATH变量
变量值： `%JAVA_HOME%\bin`
# 验证
cmd -> `java -version`
```

## Kettle安装

>下载kettle,解压到本地,双击Spoon.bat 就能启动kettle。 



# Kettle的四大组件

## Spooner（转换工具）

>Spooner是Kettle的图形化设计工具，它开源并且易于使用。可以创建和编辑PDI的转换和作业。通过拖拽图形组件，可以很方便地进行数据连接、转换设计以及调试排错。它的可视化界面使得复杂的数据处理流程变得清晰和直观。

## Kitchen（执行工具）

>Kitchen是在命令行环境下，用来执行kettle作业的工具。你可以不依赖图形化界面，在脚本或者计划任务中直接使用Kitchen来执行定义好的作业，为自动化数据处理提供了可能。

## Pan（执行工具）

>类似于Kitchen，Pan也是一个命令行工具，区别在于它用来执行的是单一的数据转换。当你希望在命令行中独立运行和调度数据转换时，Pan工具就是你的选择。

## Carte（集群服务）

>Carte是Kettle提供的轻量级的Web容器，它可以把构建在Spoon上的ETL转换和作业发布到服务器上执行，支持远程的ETL任务的运行和监控。更重要的是，Carte支持集群配置，能在多台服务器间分发转换运算，满足大规模数据处理的需求

# Kettle 的核心概念

在 Kettle 中，有两个核心概念：**转换** 和 **作业**。

## 转换 (Transformation)

转换是 Kettle 中的数据处理单元，它定义了一系列数据操作步骤，从数据源提取数据，进行转换处理，最后加载到目标数据源。常见的转换步骤包括：

- **数据输入**：从各种数据源（如数据库、CSV 文件、Excel 文件、XML 文件等）读取数据。
- **数据过滤**：根据条件过滤数据，例如删除空值、去重、筛选特定记录等。
- **数据转换**：执行数据转换操作，如数据类型转换、字符串处理、日期处理、数学运算等。
- **数据输出**：将处理后的数据写入目标数据源，例如数据库表、文件、API 等。

## 作业 (Job)

作业是 Kettle 中的任务管理单元，用于定义一系列操作步骤的执行顺序。这些步骤可以包括转换的执行、文件操作、条件判断、循环等。作业通常用于实现复杂的 ETL 流程控制。作业的常见步骤包括：

- **作业入口**：定义作业的开始点。
- **转换调用**：在作业中调用一个或多个转换。
- **文件操作**：如移动、复制、删除文件。
- **条件判断**：基于某些条件决定下一步操作。
- **循环控制**：实现重复执行某些步骤。

# 数据转换与集成

## 数据转换

1. **数据清洗**：
   - 对数据进行清洗，包括处理空值、重复值、异常值等。
   - 进行数据的规范化，确保数据格式的统一性。
   - 验证数据的有效性，并进行去噪声处理，以提高数据质量。
2. **数据标准化**：
   - 转换原始数据，使其符合特定的数据标准模式或数据规范。
   - 包括单位转换、数据归一化等操作，以确保数据的一致性和可比性。
3. **数据构建**：
   - 根据业务需求，从原始数据中提取新的特征数据。
   - 进一步创建数据模型，以支持后续的数据分析和业务决策。
4. **数据聚合**：
   - 对数据进行汇总抽象，包括进行总计、平均、最大值、最小值等统计操作。
   - 通过聚合操作，从原始数据中提炼出更高层次的信息，为分析提供更好的支持。

## 数据集成

1. **数据同步**：
   - 将分散在不同源系统中的数据，按照特定的规则同步更新到一个或多个目标系统中。
   - 确保数据的一致性和实时性，使得用户可以获取最新的数据。
2. **数据联合**：
   - 将来自不同数据源的关联数据结合在一起，提供统一的数据视图。
   - 实现对同一业务主题的全面分析，为用户提供更加综合的数据支持。
3. **数据仓库建设**：
   - 利用数据集成技术，将企业内部的业务数据进行提炼、转换和加载。
   - 构建满足多维度分析需求的数据仓库，为企业提供决策支持和业务洞察。

# 操作案例

## 转换和作业

### 转换 (Transformation)

转换包括一个或多个步骤，步骤之间通过跳（hop）来连接。跳定义了一个单向通道，允许数据从一个步骤流向另一个步骤。在 Kettle 中，数据的单位是行，数据流就是数据行从一个步骤到另一个步骤的移动。

### 作业 (Job)

作业包含了一系列转换和其他任务步骤。如果需要定时执行一系列步骤，通常会用到作业。作业可以在步骤之间设置依赖关系、条件判断和循环控制，以实现复杂的流程控制。

## 输入和输出

### CSV 输入

**步骤：**

1. 新建转换：在 Spoon 中，点击 `File` -> `New` -> `Transformation` 创建一个新的转换。
2. 添加 CSV 文件输入步骤：
   - 在左侧的 `Design` 面板中，找到 `输入` -> `CSV 文件输入`，拖动到画布上。
   - 双击 `CSV 文件输入` 步骤，打开配置对话框。
   - 指定文件位置：点击 `浏览`，选择要读取的 CSV 文件。
   - 获取字段：点击 `获取字段` 按钮，将字段类型改成 `String`。
   - 点击 `预览` 按钮，查看数据预览，确认配置无误。

### Excel 输入

**步骤：**

1. 新建转换：在 Spoon 中，点击 `File` -> `New` -> `Transformation` 创建一个新的转换。
2. 添加 Excel 文件输入步骤：
   - 在左侧的 `Design` 面板中，找到 `输入` -> `Excel 输入`，拖动到画布上。
   - 双击 `Excel 输入` 步骤，打开配置对话框。
   - 表引擎：选择 `Excel 2007 XLSX (Apache POI Streaming)`。
   - 浏览：点击 `浏览`，选择要读取的 Excel 文件。
   - 增加：点击 `增加` 按钮，添加表和工作表。
   - 获取字段：点击 `获取字段` 按钮，将字段类型改成 `String`。
   - 点击 `预览` 按钮，查看数据预览，确认配置无误。

### 文本文件输出

**步骤：**

1. 新建转换：在 Spoon 中，点击 `File` -> `New` -> `Transformation` 创建一个新的转换。
2. 添加文本文件输出步骤：
   - 在左侧的 `Design` 面板中，找到 `输出` -> `文本文件输出`，拖动到画布上。
   - 双击 `文本文件输出` 步骤，打开配置对话框。
   - 浏览：点击 `浏览`，选择输出文件的位置。
   - 扩展名：指定输出文件的扩展名（例如 `.txt`）。
   - 分隔符：指定字段之间的分隔符（例如 `,`）。

### Excel 输出

**步骤：**

1. 新建转换：在 Spoon 中，点击 `File` -> `New` -> `Transformation` 创建一个新的转换。
2. 添加 Excel 文件输出步骤：
   - 在左侧的 `Design` 面板中，找到 `输出` -> `Excel 输出`，拖动到画布上。
   - 双击 `Excel 输出` 步骤，打开配置对话框。
   - 浏览：点击 `浏览`，选择输出文件的位置。
   - 指定其他输出配置，如工作表名称和字段映射。

## 脚本执行

### SQL 脚本

**步骤：**

1. 新建作业：在 Spoon 中，点击 `File` -> `New` -> `Job` 创建一个新的作业。
2. 添加 SQL 脚本步骤：
   - 在左侧的 `Design` 面板中，找到 `SQL` -> `SQL`，拖动到画布上。
   - 双击 `SQL` 步骤，打开配置对话框。
   - 配置数据库连接：选择或新建数据库连接。
   - 编写 SQL 脚本：在 `SQL 脚本` 区域编写要执行的 SQL 语句。
   - 点击 `测试` 按钮，确认 SQL 脚本正确执行。

### SQL 表 To Excel

**步骤：**

1. 新建作业：在 Spoon 中，点击 `File` -> `New` -> `Job` 创建一个新的作业。
2. 添加转换执行步骤：
   - 在左侧的 `Design` 面板中，找到 `转换` -> `启动转换`，拖动到画布上。
   - 双击 `启动转换` 步骤，打开配置对话框。
   - 浏览：点击 `浏览`，选择一个包含以下步骤的转换文件。

**转换文件步骤：**

1. 添加表输入步骤：
   - 在 Spoon 中，新建一个转换。
   - 在左侧的 `Design` 面板中，找到 `输入` -> `表输入`，拖动到画布上。
   - 双击 `表输入` 步骤，打开配置对话框。
   - 配置数据库连接：选择或新建数据库连接。
   - 编写 SQL 查询：在 `SQL 查询` 区域编写从数据库表中提取数据的 SQL 查询。
   - 点击 `预览` 按钮，查看数据预览。
2. 添加 Excel 输出步骤：
   - 在左侧的 `Design` 面板中，找到 `输出` -> `Excel 输出`，拖动到画布上。
   - 双击 `Excel 输出` 步骤，打开配置对话框。
   - 浏览：选择输出 Excel 文件的位置。
   - 配置其他输出选项，如工作表名称和字段映射。
3. 连接表输入和 Excel 输出步骤：将 `表输入` 步骤和 `Excel 输出` 步骤连接起来。
4. 保存转换文件：保存转换文件，并在作业的 `启动转换` 步骤中引用该文件。

# 优势与应用场景

## 优势

- **可扩展性**：支持插件机制，可以根据需要扩展功能。用户可以编写自定义插件来实现特定的数据处理逻辑。
- **跨平台**：基于 Java 开发，可以运行在多种操作系统上，包括 Windows、Linux 和 macOS。
- **易用性**：提供了图形化界面，简化了 ETL 过程的设计和调试。用户不需要编写代码即可创建复杂的数据处理流程。
- **社区支持**：作为开源项目，拥有广泛的社区支持和丰富的文档资源。用户可以在社区中找到帮助和共享经验。

## 应用场景

- **数据仓库构建和维护**：将来自不同数据源的数据抽取、清洗、转换后加载到数据仓库中。
- **数据迁移和同步**：在不同数据库或系统之间迁移和同步数据。
- **数据清洗和预处理**：对原始数据进行清洗和预处理，为数据分析和机器学习准备干净的数据集。
- **报表和分析数据准备**：从各种数据源抽取数据，进行聚合和计算，为报表和数据分析提供基础数据。
