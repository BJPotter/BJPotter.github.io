---
title: 缓存问题
description: 本篇博客主要介绍了缓存在系统设计中可能会遇到的一些问题及其解决方案
tag:
- System Design
- Cache
---

# 什么是缓存

>缓存就是一个内存层，存储经常访问的数据的副本，加快客户端的响应

# 缓存一致性

>数据库中的数据更新，缓存中的数据还是旧数据，缓存的数据内容和数据库中的数据无法保持一致性。

# 缓存穿透

>缓存中没有请求的数据，并且数据库也没有该数据时（比如非法的ID或路径），会导致每个请求都直接到达数据库，从而影响性能。

# 缓存雪崩

>缓存服务器重启或缓存中大量缓存数据同时过期可能导致原本将要访问缓存的请求全部转向数据库，可能会导致数据库访问瓶颈甚至崩溃。

# 缓存预热

>为了防止缓存雪崩，需要在缓存启动后立即向缓存中加载数据

# 缓存击穿

>缓存中没有但数据库中有的数据（一般是缓存时间到期），大量请求同时读缓存没读到数据，又同时去数据库去取数据，引起数据库压力瞬间增大，造成过大压力。

# 缓存更新策略

1. 强制缓存 (Cache-Control): 设置强制缓存时间，在此期间内，不向服务器发送请求，直接使用缓存中的数据。

2. 协商缓存 (ETag/If-None-Match, Last-Modified/If-Modified-Since): 当强制缓存过期后，利用协商缓存来决定是否使用缓存中的数据。客户端通过发送带有 ETag 或者 Last-Modified 标识的请求到服务器，服务器通过对比来决定数据是否有更新，如果没有更新则返回304状态码，告知客户端直接使用本地缓存。

3. 过期机制 (Expires): 定义数据在缓存中保持有效的时间，过了这个时间则需要重新请求数据。

4. 缓存策略指定 (Cache-Control Directives): 使用某些指令如no-cache、no-store、must-revalidate等来具体指定缓存的行为。

5. 版本控制：通过给文件名（特别是静态资源如JS、CSS）添加版本号或者哈希值，当文件发生变化时更改版本号，从而使缓存失效。

6. 动态缓存更新：使用服务端推送或客户端拉取方法动态刷新缓存数据。

7. 定时刷新：在特定时间间隔后，自动更新缓存。

8. 用户操作触发：依据用户的特定操作来清除或更新缓存，如用户发帖后清除论坛的帖子列表缓存。

9. 数据变更触发：依据后端数据变更自动触发缓存的更新或失效。

10. 淘汰算法 (LRU, FIFO, LFU等): 当缓存的存储空间达到上限时，根据特定的算法来删除一些老旧的缓存数据。



