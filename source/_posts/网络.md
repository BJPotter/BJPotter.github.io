---
title: 计算机网络
tag:
- 网络
---

# OSI七层模型

## 物理层

### 作用

通过物理媒介如光纤、电缆、无线传输比特流。

### 协议

#### Ethernet

提供了一种标准的物理连接方式，通常使用双绞线、光纤等介质将计算机和网络设备（如交换机、路由器）连接起来，从而加入到一个局域网（LAN）或广域网（WAN）中。

#### Wi-Fi

提供无线连接和数据传输的能力，使设备可以通过无线方式连接到互联网或局域网，实现网络访问和数据交换。

#### RS-232

一种常用的串行通信接口标准，常被用于计算机和外部设备（如调制解调器、串口打印机、串口扫描仪等）之间进行数据传输。

#### Bluetooth

一种无线通信技术，通过无线方式将不同设备连接在一起，实现数据传输和通信。

#### USB

提供了一种通用的、高速、可靠的数据传输和设备连接方式，广泛应用于各类计算机和电子设备中。

## 数据链路层

### 作用

负责传输数据帧，提供对物理层传输错误的检测和纠正，控制发送端向接收端的传输数据帧的速率进行流量控制。

### 协议

#### Ethernet

规定了计算机和网络设备之间的数据传输方式，如数据的编码和解码方法、数据帧的格式等，使得计算机可以通过有线网络连接，并能够在网络中传输数据。

#### PPP

提供了一种点对点连接的通信机制，用于建立和管理点对点连接，并支持可靠的数据传输。

#### ARP与RARP

- **ARP**：将特定的IP地址解析为相应的MAC地址，以便在局域网中进行数据通信。通过广播ARP请求和相应的ARP响应来建立和维护IP地址和MAC地址之间的映射关系。
- **RARP**：将特定的MAC地址解析为相应的IP地址。通常需要搭建一个RARP服务器，在这个服务器上注册设备的MAC和IP，设备会请求RARP服务器返回IP地址。
- **区别**：ARP是已知IP地址求MAC地址，RARP是已知MAC地址求IP地址。

## 网络层

### 作用

负责将数据包的传输，提供路由和转发功能。

### 协议

#### IP协议

**作用**：通过IP地址进行主机标识与定位、实现数据包的路由和交换、支持网络间的通信以及提供灵活的寻址机制。

##### IP基础

- **IP与MAC的关系**：IP用于网络间通信，MAC用于直连设备间通信。
- **IP地址的定义**：IP地址（IPv4）由32位正整数表示，计算机中用二进制处理，人们便于计算用十进制标记。
- **IP地址的分类**：IP地址由网络号+主机号组成，网络号定义范围，主机号定义个数，最大主机数为2的主机号的幂-2（255用于广播，0是网络地址）。
- **无分类IP地址CIDR**：32位IP地址分为网络号和主机号，格式为a.b.c.d/x，x表示网络号位数（0~32）。
- **公网IP与私网IP**：A类、B类、C类都有部分私有IP地址。
- **IP地址与路由控制**：网络地址用于路由控制，路由表中的下一跳决定路径。
- **IP分片和重组**：链路的最大传输单元（MTU）决定分片，目标主机进行重组，TCP层引入MSS进行切片。

##### IPv6基本认识

- **由来**：IPv4地址（32位）已耗尽，IPv6地址（128位）提供更多地址。
- **IPv6地址格式**：128位地址，每16位一组，以冒号「:」隔开。
- IPv4首部与IPv6首部的改进：
  - 取消选项字段：IPv6首部固定长度40字节，传输更快。
  - 取消分片/重组字段：分片与重组仅在源与目标主机进行，提高路由器转发速度。
  - 取消首部校验和字段：数据链路层和传输层校验，IPv6取消IP校验。

#### NAT

NAT（网络地址转换）用于将私网地址转换为公网地址，因IPv4地址资源短缺而产生。NAPT（网络地址与端口转换）是NAT的扩展，不仅转换私网地址，还转换私网端口号为公网端口号。其缺点包括外部无法主动与NAT内部服务器建立连接、转换表生成带来性能开销以及NAT路由器重启时所有TCP连接被重置。解决方案包括使用IPv6和采用NAT穿透技术。

#### ICMP

ICMP（互联网控制消息协议，Internet Control Message Protocol）主要用于报告错误和进行网络诊断。其报文类型分为查询报文和差错报文。查询报文用于诊断，包括回送请求（类型8）和回送应答（类型0）。差错报文用于通知错误原因，包括目标不可达（类型3）、重定向或改变路由（类型5）和超时（类型11）。

#### OSPF

OSPF协议用于在自治系统内部实现动态路由选择和路径计算。它通过计算最短路径、动态路由更新、负载均衡和管理网络拓扑等功能，提供了高效、可靠和灵活的路由方案。

#### BGP

BGP协议使得不同自治系统之间能够交换路由信息，并根据应用策略和属性选择最佳路径。通过提供路由策略、容错性和弹性等功能，BGP协议实现了互联网中的自治系统之间的高效、灵活和可靠的路由选择。

## 传输层

### 作用

在源节点和目标节点之间建立端到端的通信连接。

### 协议

#### TCP协议

**作用**：TCP通过可靠的数据传输、流量控制、拥塞控制、连接管理和数据分割组装等机制，确保数据的安全、完整和可靠传输，并提供了端到端的通信能力。

##### TCP基本概念

- TCP头部格式：
  - **序列号**：用于解决网络包乱序的问题，通过SYN数据包发送，每次发送在上一次发送基础上+1。
  - **确认应答号**：用于解决丢包问题，服务端发送确认应答号，客户端收到后确认之前的数据包已正常接收。
  - **控制位**：包括ACK（确认应答有效）、RST（强制断开连接）、SYN（建立连接）、FIN（断开连接）。
- **TCP协议的必要性**：IP层发送数据包不可靠，TCP工作在传输层，确保接收端接收的网络包是完整的、有序的。
- **TCP连接**：用于保证可靠性和流量控制的状态信息，包括Socket、序列号和窗口大小。TCP连接由四元组（源地址、源端口、目的地址、目的端口）唯一确定。
- **TCP连接建立**：通过三次握手建立连接，确保可靠传输序列号。三次握手比两次握手更可靠，比四次握手更高效。
- **TCP分片传输**：通过MTU和MSS进行数据包切片和重组，避免IP层分片带来的问题。
- **SYN攻击**：通过伪造大量虚假IP发送SYN请求，占满服务端半连接队列，导致请求被丢弃。可通过增大队列容量、开启tcp_syncookies等方式防御。

##### TCP连接断开

- **四次挥手**：通过四次握手断开连接，确保双方数据传输完成。
- **TIME_WAIT状态**：防止历史连接数据被新连接接收，确保被动关闭连接的一方正确关闭。
- **CLOSE_WAIT状态**：服务端程序未调用close函数关闭连接时出现。
- **保活机制**：在无连接活动时发送探测报文，检测连接是否存活。

##### TCP重传与流量控制

- **重传机制**：包括超时重传和快速重传，确保数据包丢失时能及时重传。
- **滑动窗口**：通过发送窗口和接收窗口控制数据传输。
- **流量控制**：通过调整发送数据量，避免接收方缓冲区溢出。
- **拥塞控制**：通过拥塞窗口（cwnd）动态调整发送数据量，避免网络拥塞。包括慢启动、拥塞避免、拥塞发生和快速恢复等算法。

#### UDP协议

**作用**：UDP提供快速、无连接的传输，适用于实时音视频通信、游戏、传感器网络等延迟应用。

##### UDP头部格式

- **目标和源端口**：用于告诉UDP协议应该把报文发给哪个进程。
- **包长度**：保存了UDP首部的长度和数据的长度之和。
- **校验和**：提供可靠的UDP首部和数据，防止在网络传输中受损的UDP包。

#### TCP和UDP的区别

1. 连接：
   - TCP是面向连接的传输层协议，传输数据前需要建立连接。
   - UDP不需要连接，即刻传输数据。
2. 服务对象：
   - TCP是一对一的两点服务，即一条连接只有两个端点。
   - UDP支持一对一、一对多、多对多的交互通信。
3. 可靠性：
   - TCP是可靠交付数据的，数据可以无差错、不丢失、不重复、按序到达。
   - UDP尽最大努力交付，不保证可靠交付数据。
4. 拥塞控制和流量控制：
   - TCP有拥塞控制和流量控制机制，保证数据传输的安全性。
   - UDP没有拥塞控制和流量控制机制，即使网络非常拥堵，也不会影响UDP的发送速率。
5. 首部开销：
   - TCP首部长度较长，首部在没有使用「选项」字段时是20个字节，如果使用了「选项」字段则会变长。
   - UDP首部只有8个字节，并且是固定不变的，开销较小。
6. 传输方式：
   - TCP是流式传输，没有边界，但保证顺序和可靠。
   - UDP是一个包一个包的发送，有边界，但可能会丢包和乱序。
7. 分片不同：
   - TCP的数据大小如果大于MSS大小，会在传输层进行分片，目标主机收到后也在传输层组装TCP数据包，如果中途丢失了一个分片，只需要重传丢失的分片。
   - UDP的数据大小如果大于MTU大小，会在IP层进行分片，目标主机收到后在IP层组装完数据，再传给传输层。

#### TCP和UDP的应用场景

- TCP：
  - FTP文件传输
  - HTTP/HTTPS
- UDP：
  - DNS、DHCP
  - 视频、音频等多媒体通信
  - 广播通信

#### TCP和UDP可以使用同一个端口吗

可以，当主机收到数据包后，可以在IP包头的「协议号」字段知道该数据包是TCP/UDP，所以可以根据这个信息确定送给哪个模块（TCP/UDP）处理，送给TCP/UDP模块的报文根据「端口号」确定送给哪个应用程序处理。

## 会话层

### 作用

负责建立、管理和终止会话（会话是指两个应用程序之间的通信过程），提供了会话管理和同步功能。

### 协议

#### SSH

一种安全的远程登录和文件传输协议，它提供了数据加密、身份验证和安全传输的功能。通过SSH协议，用户可以远程登录到远程计算机或服务器上，并进行命令执行、文件传输和远程管理等操作，保证了远程操作过程中的安全性和可靠性。

#### SIP

一种用于建立、修改和终止多媒体会话的通信协议。它提供多媒体会话的管理和控制功能，支持注册、定位、会话协商、呼叫控制和路由等功能，使得用户可以通过多种终端进行实时的多媒体通信。

#### RDP

允许用户通过网络远程访问和控制远程计算机的桌面环境。它提供了远程控制、远程支持、虚拟化和远程桌面服务、数据安全和跨平台支持的功能。

## 表示层

### 作用

负责数据的表示、编码和加密，确保数据能够在不同系统之间正确解释和理解。

### 协议

#### JPEG

提供了图像压缩、多媒体应用、压缩质量调节、颜色空间支持和逐行扫描等功能。

#### MPEG

主要应用于视频和音频的压缩、传输和存储。它提供了视频压缩、视频传输和存储、视频流媒体和互联网传输以及音频压缩和编码的功能。

#### SSL/TLS

提供了数据传输加密、身份验证、服务器安全、统一资源定位和加密套件协商等功能。

## 应用层

### 作用

负责提供各种网络服务和应用，如电子邮件、文件传输、远程登录和网页浏览等。

### 协议

#### HTTP协议

**基本概念**：

- **HTTP**：超文本传输协议。
- 常见状态码：
  - **1xx**：协议的中间状态，较少见。
  - **2xx**：成功响应，如200（成功）、204（无内容）、206（部分内容）。
  - **3xx**：重定向，如301（永久重定向）、302（临时重定向）、304（未修改）。
  - **4xx**：客户端错误，如400（请求错误）、403（禁止访问）、404（未找到）。
  - **5xx**：服务器错误，如500（服务器错误）、501（未实现）、502（网关错误）、503（服务不可用）。
- 常见字段：
  - **客户端**：Host（域名）、Connection（保持长连接）、Accept-Encoding（接收的压缩格式）、Accept（接收的数据格式）。
  - **服务端**：Content-Length（数据长度）、Content-Type（数据格式）、Content-Encoding（压缩格式）。

**GET与POST**：

- **区别**：GET用于查询数据，POST用于修改和写入数据；GET请求较快，POST请求数据量更大。
- **安全性和幂等性**：GET是安全和幂等的，POST不是。

**HTTP特性**：

- **HTTP/1.1优点**：简单、灵活易扩展、应用广泛和跨平台。
- **HTTP/1.1缺点**：无状态、明文传输。
- **性能**：基于TCP/IP，使用长连接和管道网络传输，但存在队头阻塞问题。

**HTTP缓存技术**：

- 强制缓存：浏览器判断缓存是否过期，直接从本地获取资源。
  - **实现方式**：Cache-Control、Expires。
- 协商缓存：服务端告知客户端是否可以使用缓存。
  - **实现方式**：If-Modified-Since和Last-Modified（基于时间）、If-None-Match和ETag（基于唯一标识）。

**HTTP与HTTPS**：

- **区别**：HTTPS在TCP和HTTP之间增加了SSL/TLS协议，进行加密传输，默认端口为443。
- **解决问题**：HTTPS解决了HTTP的窃听、篡改和冒充问题，通过信息加密、校验机制和数字证书保证安全。
- **建立连接**：通过SSL/TLS协议握手，协商加密算法和生成对称密钥。

**HTTP的演变**：

- **HTTP/1.1改进**：使用长连接和管道网络传输。
- **HTTP/2优化**：头部压缩、二进制格式、并发传输、服务器推送。
- **HTTP/3优化**：解决HTTP/2队头阻塞问题，基于UDP的QUIC协议实现可靠传输。

#### DNS

**功能**：域名解析、IP地址转换、负载均衡、高可用性和故障恢复、域名管理。

**解析流程**：

1. 浏览器寻找本地缓存。
2. 本地操作系统的DNS解析器。
3. 根域寻找顶级域名。
4. 顶级根域寻找权威域名。
5. 权威域名返回该域名的IP。
6. 本地操作系统缓存IP并返回给浏览器。
7. 浏览器与目标服务器建立连接，渲染响应。

#### FTP

**功能**：文件传输、文件访问和管理、目录操作、匿名访问、安全传输、虚拟主机和共享服务器。

#### DHCP

**功能**：IP地址分配、网络配置、IP地址管理、简化网络管理、提供灵活性和可移植性。

**端口号**：客户端68，服务端67。

**通信方式**：UDP广播通信。

**协商流程**：

1. **DHCP DISCOVER**：客户端发送UDP广播找到DHCP服务器。
2. **DHCP OFFER**：服务器提供可租约的IP地址、子网掩码、默认网关、DNS服务器和IP地址租用期。
3. **DHCP REQUEST**：客户端选择一个服务器并发送请求报文响应。
4. **DHCP ACK**：服务器应答请求报文，确认参数。

#### IMAP

**功能**：邮件存储和管理、邮件同步、分段和增量下载、搜索和过滤、支持多客户端访问。

#### SMTP

**功能**：邮件传输、邮件路由、邮件队列管理、邮件身份验证、错误处理和通知。

# TCP/IP 四层模型

## 网络接口层

### 作用

负责处理与物理网络接口相关的所有功能，包括数据帧的发送和接收、物理地址的解析和硬件驱动程序的管理。

### 协议

- **Ethernet**：用于局域网中的数据帧传输。
- **PPP**：用于点对点连接。
- **ARP**：用于将IP地址解析为MAC地址。

## 网络层

### 作用

负责数据包的传输和路由选择，确保数据包能够从源地址到达目的地址。

### 协议

- **IP**：提供不可靠的、无连接的数据包传输服务。
- **ICMP**：用于报告错误和进行网络诊断。
- **OSPF**：用于自治系统内部的路由选择。
- **BGP**：用于自治系统之间的路由选择。

## 传输层

### 作用

提供端到端的通信服务，确保数据的可靠传输和正确排序。

### 协议

- **TCP**：提供可靠的、面向连接的传输服务。
- **UDP**：提供不可靠的、无连接的传输服务。

## 应用层

### 作用

提供各种网络服务和应用，如电子邮件、文件传输、远程登录和网页浏览等。

### 协议

- **HTTP**：用于网页浏览。
- **DNS**：用于域名解析。
- **FTP**：用于文件传输。
- **DHCP**：用于动态分配IP地址。
- **IMAP**：用于邮件存储和管理。
- **SMTP**：用于邮件传输。

# 扩展

## 键入网址到网页显示发生了什么

1. DNS解析：
   - 浏览器检查缓存，查找域名对应的IP地址。
   - 如果缓存中没有，操作系统的DNS解析器会向DNS服务器查询。
   - DNS服务器返回IP地址。
2. TCP连接：
   - 浏览器与服务器通过三次握手建立TCP连接。
3. 发送HTTP请求：
   - 浏览器向服务器发送HTTP请求报文，包括请求行、请求头和请求体。
4. 服务器处理请求：
   - 服务器接收到请求后，处理请求并生成响应报文。
5. 返回HTTP响应：
   - 服务器将响应报文通过TCP连接返回给浏览器，包括状态行、响应头和响应体。
6. 渲染网页：
   - 浏览器接收到响应报文后，解析HTML、CSS和JavaScript，渲染网页。
7. 关闭连接：
   - 浏览器与服务器通过四次挥手断开TCP连接。

## Linux系统如何收发网络包的

1. 网络接口：
   - 网络包通过网络接口（如以太网卡、Wi-Fi适配器）进入Linux系统。
2. 内核网络栈：
   - 网络包进入内核网络栈，经过多个层次的处理，包括链路层、网络层和传输层。
3. 链路层：
   - 处理MAC地址、帧校验等链路层相关信息。
4. 网络层：
   - 处理IP地址、路由选择等网络层相关信息。
5. 传输层：
   - 处理TCP/UDP端口、序列号、确认号等传输层相关信息。
6. 协议栈：
   - 根据协议栈的处理结果，将网络包传递给相应的应用程序。
7. 发送网络包：
   - 应用程序生成网络包，通过系统调用将数据传递给内核网络栈。
   - 内核网络栈根据路由表和ARP表，将网络包发送到相应的网络接口，最终通过物理网络传输到目标设备。

## Cookie和Session

**Cookie**：

- **定义**：存储在客户端的小数据文件，用于在客户端和服务器之间传递信息。
- 特点：
  - 存储在客户端（浏览器）。
  - 每次请求都会自动发送到服务器。
  - 可以设置过期时间。
  - 安全性较低，容易被篡改。
- 用途：
  - 记录用户登录状态。
  - 存储用户偏好设置。
  - 跟踪用户行为。

**Session**：

- **定义**：存储在服务器端的会话数据，用于跟踪用户的会话状态。
- 特点：
  - 存储在服务器端。
  - 通过Session ID在客户端和服务器之间传递。
  - 通常在用户关闭浏览器或会话超时时失效。
  - 安全性较高，不容易被篡改。
- 用途：
  - 记录用户登录状态。
  - 存储用户临时数据。
  - 跟踪用户会话。

## 进制之间的转换

**二进制（Binary）**：以2为基数，使用0和1表示。

**八进制（Octal）**：以8为基数，使用0-7表示。

**十进制（Decimal）**：以10为基数，使用0-9表示。

**十六进制（Hexadecimal）**：以16为基数，使用0-9和A-F表示。

**转换方法**：

1. 二进制转十进制：

   - 从右到左，每位乘以2的对应次幂，然后求和。
   - 例子：1011（二进制） = 1*2^3 + 0*2^2 + 1*2^1 + 1*2^0 = 11（十进制）。

2. 十进制转二进制

   ：

   - 除以2，记录余数，直到商为0，逆序排列余数。
   - 例子：11（十进制） = 1011（二进制）。

3. 二进制转八进制：

   - 每三位二进制数转换为一位八进制数。
   - 例子：1011（二进制） = 001 011 = 13（八进制）。

4. 八进制转二进制：

   - 每位八进制数转换为三位二进制数。
   - 例子：13（八进制） = 001 011 = 1011（二进制）。

5. 二进制转十六进制：

   - 每四位二进制数转换为一位十六进制数。
   - 例子：1011（二进制） = 0001 0110 = 16（十六进制）。

6. 十六进制转二进制：

   - 每位十六进制数转换为四位二进制数。
   - 例子：16（十六进制） = 0001 0110 = 1011（二进制）。

7. 十进制转八进制：

   - 除以8，记录余数，直到商为0，逆序排列余数。
   - 例子：11（十进制） = 13（八进制）。

8. 八进制转十进制：

   - 从右到左，每位乘以8的对应次幂，然后求和。
   - 例子：13（八进制） = 1*8^1 + 3*8^0 = 11（十进制）。

9. 十进制转十六进制：

   - 除以16，记录余数，直到商为0，逆序排列余数。
   - 例子：11（十进制） = B（十六进制）。

10. 十六进制转十进制：

    - 从右到左，每位乘以16的对应次幂，然后求和。
    - 例子：B（十六进制） = 11（十进制）。
