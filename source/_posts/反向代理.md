---
title: 反向代理
tag:
- 系统设计
typora-root-url: ./..
---

# 反向代理

## 什么是反向代理

>反向代理是位于web服务器前面的服务器，所有的客户端请求都将请求发送到反向代理服务器，由反向代理服务器将请求发送到web服务器。

## 什么是代理服务器

>转发代理（正向代理），一般简称位代理或者代理服务器，是位于客户端和服务端之间的中间设备，当客户端发送请求到服务端的时候，代理服务器会拦截这些请求，充当客户端去跟服务端进行交互，然后再响应给实际的客户端。

<img src="/images/代理.png" style="zoom:38%;" />

>上图为一个转发代理流程(A：用户服务器，B: 代理服务器，C：目的服务器),在正常的通信中A与C经过互联网后直接通信，在转发服务中，A先将请求发送到B，B在跟C通信，B收到C的响应数据后再响应给A

**优点：**

1. 通过代理可以穿越客户端无法直接访问的网站。
2. 隐藏自己的身份如发表评论可以隐藏自己的IP
3. 通过代理进行流量控制，如拒绝访问淘宝的流量
4. 代理服务器缓存静态网站可以提高浏览性能

## 反向代理有何区别

>从正向代理来看，WEB服务器不知道谁是真正的客户端，反向代理来看，客户端不知道谁是真正的WEB服务器

<img src="/images/反向代理.png" style="zoom:38%;" />

>上图正常通信的时候D会直接访问F，现在D将请求发送到E,E请请求发送到F,F响应E,再由E想用给真正的客户端。

**优点：**

1. 负载均衡，通过反向代理实现负载均衡防止单个服务器过载。
2. 安全，经过反向代理后不会暴露真实WEB服务器的IP，只会暴露反向代理的IP，攻击者只能共计反向代理服务器。
3. 缓存提高网站的访问性能

## 反向代理开源软件

>Nginx、HAProxy、Apache Http Server

**以nginx为例实现配置：**

```nginx
http {
    upstream backend {
        server 192.168.1.2:80;
    }

    server {
        listen 80;

        location / {
            proxy_pass http://backend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }
}
```

>上述Nginx配置，后端服务器地址是192.168.1.2，客户端通过访问反向代理来接触到后端服务。